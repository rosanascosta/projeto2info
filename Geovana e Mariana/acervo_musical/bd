DROP DATABASE IF EXISTS acervo;
CREATE DATABASE acervo;
USE acervo;

CREATE TABLE usuarios (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(150) NOT NULL UNIQUE,
    senha VARCHAR(255) NOT NULL,
    foto LONGBLOB,
    data_cadastro DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE artistas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(150) NOT NULL,
    descricao TEXT,
    imagem LONGBLOB,
    genero VARCHAR(100)
);

CREATE TABLE albuns (
    id INT PRIMARY KEY AUTO_INCREMENT,
    artista_id INT NOT NULL,
    titulo VARCHAR(200) NOT NULL,
    ano INT,
    descricao TEXT,
    genero VARCHAR(100),
    n_faixas INT,
    duracao VARCHAR(20),
	capa VARCHAR(255),
    FOREIGN KEY (artista_id) REFERENCES artistas(id) ON DELETE CASCADE
);

CREATE TABLE musicas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    album_id INT NOT NULL,
    titulo VARCHAR(200) NOT NULL,
    duracao VARCHAR(10),
    letra TEXT,
    FOREIGN KEY (album_id) REFERENCES albuns(id) ON DELETE CASCADE
);

CREATE TABLE comentarios (
    id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT NOT NULL,

    artista_id INT NULL,
    album_id INT NULL,
    musica_id INT NULL,

    texto TEXT NOT NULL,
    data DATETIME DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (usuario_id) REFERENCES usuarios(id) ON DELETE CASCADE,
    FOREIGN KEY (artista_id) REFERENCES artistas(id) ON DELETE SET NULL,
    FOREIGN KEY (album_id) REFERENCES albuns(id) ON DELETE SET NULL,
    FOREIGN KEY (musica_id) REFERENCES musicas(id) ON DELETE SET NULL
);

CREATE TABLE favoritos (
    id INT PRIMARY KEY AUTO_INCREMENT,
    id_usuario INT NOT NULL,
    tipo VARCHAR(20) NOT NULL,         
    item_id INT NOT NULL,
    data DATETIME DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (id_usuario) REFERENCES usuarios(id) 
        ON DELETE CASCADE
);

INSERT INTO artistas (nome, genero, descricao)
VALUES
('Olivia Rodrigo', 'POP', 
'Olivia Rodrigo é uma cantora, compositora e atriz norte-americana que começou sua carreira em séries da Disney. 
Em 2021, estourou mundialmente com SOUR, seu álbum de estreia, misturando pop emocional e influências de rock 
alternativo. Em 2023 lançou GUTS, consolidando sua imagem como uma das vozes jovens mais marcantes do pop atual. 
Seu trabalho é conhecido por letras confessionais e grande impacto nas redes sociais.'),

('Nirvana', 'Rock', 
'Nirvana foi uma das bandas mais influentes da história do rock e do movimento grunge. 
Formada por Kurt Cobain, Krist Novoselic e Dave Grohl, lançou três álbuns de estúdio, incluindo o icônico Nevermind. 
Suas canções uniam distorção, emoção crua e crítica social. O grupo terminou após a morte de Cobain em 1994, 
mas segue como referência cultural e musical.'),

('Secos & Molhados', 'MPB',
'Secos & Molhados foi um grupo brasileiro revolucionário dos anos 1970, liderado por Ney Matogrosso. Misturando MPB, 
rock, poesia e forte teatralidade, lançaram dois álbuns que se tornaram clássicos. A banda marcou época pela 
ousadia estética, crítica social e pela voz marcante de Ney.');

INSERT INTO albuns (titulo, ano, artista_id, capa,descricao,genero,  n_faixas, duracao)
VALUES
('SOUR', "2021", 1, 'albuns/sour.jpg', 
"'SOUR' é o álbum de estreia de Olivia Rodrigo, lançado em 21 de maio de 2021 pela Geffen Records. O disco foi produzido principalmente por Dan Nigro, que ajudou a construir a 
sonoridade crua e emocional que define o projeto. Musicalmente, SOUR mistura pop alternativo, indie pop, pop-punk e baladas melancólicas, combinando guitarras distorcidas, arranjos
 minimalistas e vocais intensamente expressivos.", 
 'Pop rock', 11, '34:41'
),
('GUTS', "2023", '1', 'guts.jpg', 
"'GUTS' é o segundo álbum de estúdio de Olivia Rodrigo, lançado em 8 de setembro de 2023 pela Geffen Records. Produzido novamente por Dan Nigro, o disco aprofunda e expande a estética 
que marcou a estreia da artista, trazendo uma sonoridade mais encorpada e confiante. Musicalmente, mistura pop rock, alternative rock, pop-punk e indie pop, com guitarras mais agressivas, 
bateria energizante e momentos de vulnerabilidade guiados pelo piano.", 
'Pop rock',12, '39:00'
),

('Bleach', '1989', 2, 'bleach.jpg',
"'Bleach' é o álbum de estreia do Nirvana, lançado em 15 de junho de 1989 pela Sub Pop. 
Produzido por Jack Endino, apresenta uma sonoridade crua e pesada, com influências de 
punk e rock alternativo. Liricamente, aborda frustração, identidade marginal e desgosto 
existencial, com o tom áspero que marcou o início da banda.",
'Grunge','13', '42:45'),
('Nevermind', '1991', 2, 'nevermind.jpg',
"'Nevermind' é o segundo álbum de estúdio do Nirvana, lançado em 24 de setembro de 1991 pela 
DGC Records. Produzido por Butch Vig, mistura grunge com pop-punk e alternative rock, 
trazendo ganchos melódicos poderosos. Liricamente, explora alienação, confusão emocional 
e crítica social, impulsionando a banda ao mainstream.",
'Grunge','13', '49:15'),
('In Utero', '1993', 2, 'inutero.jpg',
"'In Utero' é o terceiro álbum de estúdio do Nirvana, lançado em 21 de setembro de 1993. 
Produzido por Steve Albini (com ajustes posteriores), traz uma sonoridade mais áspera e 
experimental. Liricamente, aborda dor, frustração, fama e conflito interno, em letras 
intensas e arranjos agressivos.",
'Grunge','12', '41:27'),
('A volta de Secos & Molhados', '1973', 3, 'avdsm.jpg',
"'A volta de Secos & Molhados' é o segundo e último álbum de estúdio do Joy Division, lançado em 18 de julho de 
1980. Produzido por Martin Hannett, aprofunda a sonoridade melancólica e etérea do grupo. 
Liricamente, trata de decadência emocional, morte, perda e introspecção, em composições 
densas e atmosféricas.",
'MPB','11', '30:39'),
('Secos & Molhados', '1978', 3, 'secosemolhados.jpg',
"O álbum 'Secos & Molhados' (1978) marca uma das fases tardias da banda, lançado já após a 
formação clássica que a consagrou nos anos 70. O disco mantém a característica fusão de MPB 
com art rock e folk rock, trazendo arranjos experimentais e letras poéticas que exploram 
temas como reflexão existencial, crítica social e imaginação lírica — elementos que sempre 
definiram a identidade estética do grupo. Musicalmente, o álbum combina vocais expressivos, 
harmonias marcantes e instrumentações que transitam entre o acústico e o teatral, preservando 
o estilo performático e vanguardista que diferenciou os Secos & Molhados na música brasileira. 
Apesar de surgir em um momento de transição, ele reflete a busca contínua do projeto por 
renovação artística, mantendo viva a essência mística, provocativa e estética da banda.",
'MPB','11', '39:37');

INSERT INTO musicas (album_id, titulo, duracao, letra) VALUES
(1, 'brutal', '2:23', 'Letras/Olivia/sour/brutal.txt'),
(1, 'traitor', '3:49', 'Letras/Olivia/sour/traitor.txt'),
(1, 'drivers license', '4:02', 'Letras/Olivia/sour/driverslicense.txt'),
(1, '1 step forward, 3 steps back', '2:43', 'Letras/Olivia/sour/stepf.txt'),
(1, 'deja vu', '3:36', 'Letras/Olivia/sour/dejavu.txt'),
(1, 'good 4 u', '2:58', 'Letras/Olivia/sour/goodfu.txt'),
(1, 'enough for you', '3:22', 'Letras/Olivia/sour/enoughforyou.txt'),
(1, 'happier', '2:55', 'Letras/Olivia/sour/happier.txt'),
(1, 'jealousy, jealousy', '2:53', 'Letras/Olivia/sour/jealousy.txt'),
(1, 'favorite crime', '2:32', 'Letras/Olivia/sour/favoritecrime.txt'),
(1, 'hope ur ok', '3:29', 'Letras/Olivia/sour/hopeurok.txt');

INSERT INTO musicas (album_id, titulo, duracao, letra) VALUES
(2, 'all-american bitch', '2:45', 'Letras/Olivia/Guts/allamericanb.txt'),
(2, 'bad idea right?', '2:30', 'Letras/Olivia/Guts/badidear.txt'),
(2, 'vampire', '3:39', 'Letras/Olivia/Guts/vampire.txt'),
(2, 'lacy', '2:54', 'Letras/Olivia/Guts/lacy.txt'),
(2, 'ballad of a homeschooled girl', '2:57', 'Letras/Olivia/Guts/boahg.txt'),
(2, 'making the bed', '2:55', 'Letras/Olivia/Guts/makingthebed.txt'),
(2, 'logical', '3:51', 'Letras/Olivia/Guts/logical.txt'),
(2, 'get him back!', '3:29', 'Letras/Olivia/Guts/gethimback.txt'),
(2, 'love is embarassing', '2:34', 'Letras/Olivia/Guts/loveise.txt'),
(2, 'the grudge', '3:09', 'Letras/Olivia/Guts/thegrudge.txt'),
(2, 'pretty isn''t pretty', '2:47', 'Letras/Olivia/Guts/pip.txt'),
(2, 'teenage dream', '3:49', 'Letras/Olivia/Guts/teenagedream.txt');

INSERT INTO musicas (album_id, titulo, duracao, letra) VALUES
(3, 'Blew', '2:54', 'Letras/nirvana/bleach/blew.txt'),
(3, 'Floyd the Barber', '2:18', 'Letras/nirvana/bleach/ftb.txt'),
(3, 'About a Girl', '2:48', 'Letras/nirvana/bleach/aag.txt'),
(3, 'School', '2:42', 'Letras/nirvana/bleach/school.txt'),
(3, 'Love Buzz', '3:35', 'Letras/nirvana/bleach/lovebuzz.txt'),
(3, 'Paper Cuts', '4:06', 'Letras/nirvana/bleach/papercuts.txt'),
(3, 'Negative Creep', '2:56', 'Letras/nirvana/bleach/negativecreep.txt'),
(3, 'Scoff', '4:10', 'Letras/nirvana/bleach/scoff.txt'),
(3, 'Swap Meet', '3:03', 'Letras/nirvana/bleach/swapmeet.txt'),
(3, 'Mr. Moustache', '3:24', 'Letras/nirvana/bleach/moustache.txt'),
(3, 'Sifting', '5:22', 'Letras/nirvana/bleach/sifting.txt');

INSERT INTO musicas (album_id, titulo, duracao, letra) VALUES
(4, 'Smells Like Teen Spirit', '5:01', 'Letras/nirvana/nevermind/slts.txt'),
(4, 'In Bloom', '4:14', 'Letras/nirvana/nevermind/inbloom.txt'),
(4, 'Come as You Are', '3:39', 'Letras/nirvana/nevermind/caya.txt'),
(4, 'Breed', '3:03', 'Letras/nirvana/nevermind/breed.txt'),
(4, 'Lithium', '4:17', 'Letras/nirvana/nevermind/lithium.txt'),
(4, 'Polly', '2:57', 'Letras/nirvana/nevermind/polly.txt'),
(4, 'Territorial Pissings', '2:22', 'Letras/nirvana/nevermind/tp.txt'),
(4, 'Drain You', '3:43', 'Letras/nirvana/nevermind/drainyou.txt'),
(4, 'Lounge Act', '2:36', 'Letras/nirvana/nevermind/loungeact.txt'),
(4, 'Stay Away', '3:33', 'Letras/nirvana/nevermind/stayaway.txt'),
(4, 'On a Plain', '3:16', 'Letras/nirvana/nevermind/oap.txt'),
(4, 'Something in the Way', '3:52', 'Letras/nirvana/nevermind/sitw.txt');

INSERT INTO musicas (album_id, titulo, duracao, letra) VALUES
(5, 'Serve the Servants', '3:36', 'Letras/nirvana/inutero/sts.txt'),
(5, 'Scentless Apprentice', '3:48', 'Letras/nirvana/inutero/sa.txt'),
(5, 'Heart-Shaped Box', '4:41', 'Letras/nirvana/inutero/hsb.txt'),
(5, 'Rape Me', '2:50', 'Letras/nirvana/inutero/rapeme.txt'),
(5, 'Frances Farmer Will Have Her Revenge on Seattle', '4:09', 'Letras/nirvana/inutero/ffwhhr.txt'),
(5, 'Dumb', '2:29', 'Letras/nirvana/inutero/dumb.txt'),
(5, 'Very Ape', '1:55', 'Letras/nirvana/inutero/veryape.txt'),
(5, 'Milk It', '3:55', 'Letras/nirvana/inutero/milkit.txt'),
(5, 'Pennyroyal Tea', '3:37', 'Letras/nirvana/inutero/penny.txt'),
(5, 'Radio Friendly Unit Shifter', '4:51', 'Letras/nirvana/inutero/rfus.txt'),
(5, 'Tourette''s', '1:33', 'Letras/nirvana/inutero/tourette.txt'),
(5, 'All Apologies', '3:51', 'Letras/nirvana/inutero/alla.txt');


INSERT INTO musicas (album_id, titulo, duracao, letra) VALUES
(6, 'Sangue Latino', '2:07', 'Letras/secosemolhados/avoltadesecosemolhados/sanguelatino.txt'),
(6, 'O Vira', '2:14', 'Letras/secosemolhados/avoltadesecosemolhados/ovira.txt'),
(6, 'Não, não digas nada', '1:38', 'Letras/secosemolhados/avoltadesecosemolhados/nndn.txt'),
(6, 'Amor', '2:15', 'Letras/secosemolhados/avoltadesecosemolhados/amor.txt'),
(6, 'Primavera Nos Dentes', '4:46', 'Letras/secosemolhados/avoltadesecosemolhados/primaverand.txt'),
(6, 'Assim Assado', '2:50', 'Letras/secosemolhados/avoltadesecosemolhados/assimassado.txt'),
(6, 'Mulher Barriguda', '2:35', 'Letras/secosemolhados/avoltadesecosemolhados/mulherb.txt'),
(6, 'El Rey', '0:57', 'Letras/secosemolhados/avoltadesecosemolhados/elrey.txt'),
(6, 'Rosa De Hiroshima', '1:59', 'Letras/secosemolhados/avoltadesecosemolhados/rosadehi.txt'),
(6, 'Rondó Do Capitão', '1:00', 'Letras/secosemolhados/avoltadesecosemolhados/rdc.txt'),
(6, 'As Andorinhas', '0:53', 'Letras/secosemolhados/avoltadesecosemolhados/asandorinhas.txt');

INSERT INTO musicas (album_id, titulo, duracao, letra) VALUES
(7, "Que Fim Levaram Todas As Flores?",'3:37', "secosemolhados/secosemolhados_m/qfltaf.txt"),
(7, "Lindeza", '3,44',"secosemolhados/secosemolhados_m/lindeza.txt"),
(7,"De Mim Pra Você",'4:17', "secosemolhados/secosemolhados_m/dmpv.txt"),
(7, "Minha Namorada",'3:26', "secosemolhados/secosemolhados_m/minhanamorada.txt"),
(7,"Anônimo Brasileiro",'5:06', "secosemolhados/secosemolhados_m/abrasileiro.txt"),
(7,"Última Lágrima",'2:53' ,"secosemolhados/secosemolhados_m/ultimalagrima.txt"),
(7, "Insatisfação",'2:35', "secosemolhados/secosemolhados_m/insatisfacao.txt"),
(7, "Oh! Canção Vulgar",'4:08', "secosemolhados/secosemolhados_m/cancaov.txt"),
(7, "Como Eu, Como Tu",'3:13', "secosemolhados/secosemolhados_m/comoeucomotu.txt"),
(7, "Quadro Negro", '2:00',"secosemolhados/secosemolhados_m/quadronegro.txt"),
(7, "Cobra Coral Indiana",'4:41', "secosemolhados/secosemolhados_m/cobracoral.txt");

CREATE OR REPLACE VIEW favoritos_artistas AS
SELECT f.id, f.id_usuario, f.item_id AS artista_id, f.data
FROM favoritos f
WHERE f.tipo = 'artista';

CREATE OR REPLACE VIEW favoritos_albuns AS
SELECT f.id, f.id_usuario, f.item_id AS album_id, f.data
FROM favoritos f
WHERE f.tipo = 'album';

CREATE OR REPLACE VIEW favoritos_musicas AS
SELECT f.id, f.id_usuario, f.item_id AS musica_id, f.data
FROM favoritos f
WHERE f.tipo = 'musica';


SELECT * FROM usuarios;
SELECT * FROM artistas;
SELECT * FROM albuns;
SELECT * FROM musicas;
SELECT id, email, senha FROM usuarios;

